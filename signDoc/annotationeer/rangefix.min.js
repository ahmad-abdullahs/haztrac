!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports&&"string"!=typeof exports.nodeName?module.exports=e():t.RangeFix=e()}(this,function(){var a,t={};function d(t){var e;return t?screen.deviceXDPI===screen.logicalXDPI?t:"length"in t?Array.prototype.map.call(t,d):(e=screen.deviceXDPI/screen.logicalXDPI,{top:t.top/e,bottom:t.bottom/e,left:t.left/e,right:t.right/e,width:t.width/e,height:t.height/e}):t}function l(t,e){var n,i=0,o=1024;if(o>=e.length)return Array.prototype.push.apply(t,e);for(;i<e.length;)n=Array.prototype.push.apply(t,Array.prototype.slice.call(e,i,i+o)),i+=o;return n}return t.isBroken=function(){var t,e,n,i,o,r,c,l;return void 0===a&&(e=document.createElement("p"),n=document.createElement("span"),i=document.createTextNode("aa"),o=document.createTextNode("aa"),(r=document.createElement("img")).setAttribute("src","data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="),c=document.createRange(),a={},e.appendChild(i),e.appendChild(n),n.appendChild(r),n.appendChild(o),document.body.appendChild(e),c.setStart(i,1),c.setEnd(n,0),a.getClientRects=a.getBoundingClientRect=1<c.getClientRects().length,a.getClientRects||(c.setEnd(o,1),a.getClientRects=a.getBoundingClientRect=2===c.getClientRects().length),a.getBoundingClientRect||(c.setEnd(c.startContainer,c.startOffset),t=c.getBoundingClientRect(),a.getBoundingClientRect=0===t.top&&0===t.left),document.body.removeChild(e),l=window.ActiveXObject&&new Function("/*@cc_on return @_jscript_version; @*/")(),a.ieZoom=!!l&&l<=10),a},t.getClientRects=function(t){var e,n,i,o,r,c=this.isBroken();if(c.ieZoom)return d(t.getClientRects());if(!c.getClientRects)return t.getClientRects();for(e=[],i=[],n=t.endContainer,o=t.endOffset,r=document.createRange();n!==t.commonAncestorContainer;)r.setStart(n,0),r.setEnd(n,o),l(i,r.getClientRects()),o=Array.prototype.indexOf.call(n.parentNode.childNodes,n),n=n.parentNode;return(r=t.cloneRange()).setEnd(n,o),l(e,r.getClientRects()),l(e,i),e},t.getBoundingClientRect=function(t){var e,n,i,o,r,c,l=this.getClientRects(t);if(0===l.length)return null;if(r=t.getBoundingClientRect(),(c=this.isBroken()).ieZoom)return d(r);if(!c.getBoundingClientRect)return r;if(0===r.width&&0===r.height)return l[0];for(e=0,n=l.length;e<n;e++)o=l[e],i?(i.left=Math.min(i.left,o.left),i.top=Math.min(i.top,o.top),i.right=Math.max(i.right,o.right),i.bottom=Math.max(i.bottom,o.bottom)):i={left:o.left,top:o.top,right:o.right,bottom:o.bottom};return i&&(i.width=i.right-i.left,i.height=i.bottom-i.top),i},t});